<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cattle Classifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">
    <h1>AI Cattle Breed Classifier</h1>
    <h3>Instant Identification System</h3>

    <form id="upload-form">
        <label class="upload-box">
            <span class="icon-large">üêÑ</span>
            <span id="file-label">Click to Upload Image</span>
            <input type="file" id="file-input" accept="image/*" onchange="previewFile()">
        </label>

        <img id="preview-image" alt="Preview">

        <br><br>
        <button type="button" class="btn" onclick="uploadImage()">Identify Breed</button>
    </form>

    <div class="loader" id="loader"></div>

    <div id="result-area">
        <p style="margin:0; color:#888; font-size:14px;">PREDICTED BREED</p>
        <div class="prediction-text" id="breed-name">--</div>
        <p style="color:#666; margin:0;">
            Confidence Score: <strong id="confidence-score">--</strong>%
        </p>
    </div>
</div>

<script>
function previewFile() {
    const preview = document.getElementById('preview-image');
    const file = document.getElementById('file-input').files[0];
    const label = document.getElementById('file-label');

    if (file) {
        label.textContent = "Selected: " + file.name;
        label.style.fontWeight = "bold";
        label.style.color = "#185a9d";

        const reader = new FileReader();
        reader.onload = e => {
            preview.src = e.target.result;
            preview.style.display = "block";
        };
        reader.readAsDataURL(file);
    }
}

async function uploadImage() {
    const file = document.getElementById('file-input').files[0];
    if (!file) {
        alert("Please select an image first!");
        return;
    }

    document.getElementById('loader').style.display = 'block';
    document.getElementById('result-area').style.display = 'none';

    const formData = new FormData();
    formData.append('file', file);

    try {
        const response = await fetch('/predict', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        document.getElementById('loader').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';

        document.getElementById('breed-name').innerText = data.class || "Error";
        document.getElementById('confidence-score').innerText = data.confidence || "--";
    } catch {
        alert("Server error");
        document.getElementById('loader').style.display = 'none';
    }
}
</script>

</body>
</html>
